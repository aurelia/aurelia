<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Aurelia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta http-equiv="cache-control" content="max-age=0" />
  <meta http-equiv="cache-control" content="no-cache" />
  <meta http-equiv="expires" content="0" />
  <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
  <meta http-equiv="pragma" content="no-cache" />
  <script>
    function getAureliaMeasurements() {
      const measurements = performance.getEntriesByType('measure');
      const ii = measurements.length;
      const results = Array(ii);
      for (let i = 0; i < ii; ++i) {
        const measurement = measurements[i];
        results[i] = { name: measurement.name, duration: (measurement.duration + 0.5) | 0, startTime: (measurement.startTime + 0.5) | 0 };
      }
      return results;
    }
    class Instrumenter {
      constructor() {
        this.queuedActions = [];
        this.previousLifecycle = null;
        this.taskQueue = null;
        this.queued = false;
      }
      call() {
        const actions = this.queuedActions;
        for (let i = 0, ii = actions.length; i < ii; ++i) {
          this.markActionEnd(actions[i]);
        }
        this.queuedActions = [];
        this.queued = false;
      }
      markLifecycle(name) {
        const current = `aurelia-${name}`;
        performance.mark(current);
        const previous = this.previousLifecycle;
        this.previousLifecycle = current;
        if (previous !== null) {
          performance.measure(`${previous}_to_${current}`, previous, current);
        }
        console.log(current);
      }
      markActionStart(name, queued) {
        const markStart = `aurelia-action-${name}-start`;
        performance.mark(markStart);
        this.queuedActions.push(name);
        this['$'+name] = 0;
        //console.log(markStart);
      }
      markActionEnd(name) {
        const markEnd = `aurelia-action-${name}-end`;
        const markStart = `aurelia-action-${name}-start`;
        performance.mark(markEnd);
        const dollarName = '$'+name;
        const flushCount = this[dollarName];
        this[dollarName] = 0;
        if (flushCount > 0) {
          const measureFlush = `aurelia-action-${name}-flush-${flushCount}`;
          performance.measure(measureFlush, measureFlush, markEnd);
        }
        performance.measure(`aurelia-action-${name}`, markStart, markEnd);
        //console.log(markEnd);
      }
    }
    var instrumenter = window.instrumenter = new Instrumenter();
    instrumenter.markLifecycle('page-loaded');
  </script>
</head>

<body>
  <script>
      instrumenter.markLifecycle('body-loaded');
  </script>
  <div aurelia-app="dist/main"></div>
  <script src="dist/vendor-bundle.js" data-main="aurelia-bootstrapper">
  </script>
  <script>
      instrumenter.markLifecycle('script-loaded');
  </script>
</body>

</html>
